#version 330

in vec4 gs_Color;
noperspective in vec3 gs_TexCoord;
out vec4 fragColor;

layout(std140) uniform Object
{
	mat4 c_mWorldViewProjection;
	mat4 c_mWorldView;
	vec4 c_vCorner000;
	vec4 c_vCorner001;
	vec4 c_vCorner010;
	vec4 c_vCorner011;
	vec4 c_vCorner100;
	vec4 c_vCorner101;
	vec4 c_vCorner110;
	vec4 c_vCorner111;
};

void main()
{
	vec2 correctedTexCoord;
	correctedTexCoord.x = gs_TexCoord.x / gs_TexCoord.z;
	correctedTexCoord.y = gs_TexCoord.y;

	// Fading along the line direction only close to the ends
	float fadeLong = max(0, abs(correctedTexCoord.x) * c_vCorner000.y - c_vCorner000.x);
	fadeLong = max(0, 1 - fadeLong * fadeLong);
	// Maximal smooth fading about beem width
	float fadeShort = max(0, 1 - correctedTexCoord.y * correctedTexCoord.y);
	fragColor = gs_Color * fadeShort * fadeLong;
}
